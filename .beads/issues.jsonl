{"id":"ais-1","title":"SECURITY: Command injection and race conditions in session creation","description":"Multiple injection vectors: (1) bin/ais cmd_create() collects extra args via '--' and interpolates them directly into tmux send-keys without escaping — shell metacharacters (`;`, `|`, `$()`) execute arbitrary commands. (2) Background command injection has a race condition — if the session dies before injection completes, the failure is silent and undetected. (3) bin/kimi-account cmd_add() embeds the API key directly into a TOML heredoc without escaping — a key containing '\"' or '\\' produces malformed config or injects arbitrary TOML. (4) check-kimi-credit.sh passes $cred_file path unescaped into an inline 'python3 -c \"...\"' string — a path with special chars breaks Python syntax or enables code injection.","type":"bug","priority":0,"status":"open","created":"2026-03-01T00:00:00Z","updated":"2026-03-01T00:00:00Z","tags":["security","injection","bin/ais","bin/kimi-account","scripts"]}
{"id":"ais-2","title":"SECURITY: Hardcoded tmux session name causes data mixing; missing output sanitization","description":"(1) check-credit.sh uses TMUX_SESSION='credit-check-tmp' (hardcoded) — if two users or two CI jobs run the script simultaneously, they capture each other's panes and silently mix credit data across accounts. Fix: append PID and random suffix (e.g. 'credit-check-$$-$RANDOM'). (2) check-credit.sh and check-kimi-credit.sh call 'tmux capture-pane' but never pipe output through sanitize_utf8() (defined in bin/ais) — ANSI escape codes and non-printable characters survive into grep/sed patterns, causing silent parse failures. Every capture-pane call in both scripts needs '| LC_ALL=C sed ...' sanitization.","type":"bug","priority":0,"status":"open","created":"2026-03-01T00:00:00Z","updated":"2026-03-01T00:00:00Z","tags":["security","check-credit","sanitization","tmux"]}
{"id":"ais-3","title":"HIGH: Missing input validation across bin/ais and bin/kimi-account","description":"(1) bin/ais: -n/--lines and -i/--interval flags accept any string — passing a non-numeric value (e.g. 'ais inspect s -n abc') produces a cryptic tmux error with no useful message. Validate with [[ $val =~ ^[0-9]+$ ]]. (2) bin/ais: --size flag splits on 'x' without validating the WxH pattern first — 'ais create s --size 160' or '--size abc' silently creates a session with wrong/default dimensions. Add regex: [[ \"$2\" =~ ^[0-9]+x[0-9]+$ ]]. (3) bin/ais: CLAUDE_BIN and KIMI_BIN are set as '~/.local/bin/...' — tilde is NOT expanded in variable assignment context, so the '-x \"$binary\"' existence check silently fails. Use \"${HOME}/.local/bin/...\" instead. (4) bin/kimi-account cmd_run(): account name argument is used directly as a directory component without sanitization — allows path traversal (e.g. '../../../etc').","type":"bug","priority":1,"status":"open","created":"2026-03-01T00:00:00Z","updated":"2026-03-01T00:00:00Z","tags":["validation","bin/ais","bin/kimi-account","ux"]}
{"id":"ais-4","title":"HIGH: Portability failures and fragile parsing in check-credit.sh","description":"(1) 'date -d' (GNU coreutils extension) is used throughout check-credit.sh — this flag does not exist on macOS/BSD date; the script fails silently or produces garbage output on non-Linux systems with no warning. (2) Credit percentage extraction uses 'grep -oP \"\\d+(?=% used)\"' — tied to Claude Code's current output format; any upstream version change silently returns empty string, leading to '?' in all fields without alerting the user that parsing failed. (3) The main wait loop runs 30 iterations × 2s sleep = 60s max, but has no overall timeout guard — if Claude Code hangs at startup the script blocks indefinitely. (4) CLAUDE_BIN is set to '~/.npm/bin/claude' (line ~12) but bin/ais uses '~/.local/bin/claude' — inconsistency means check-credit.sh may use a different Claude installation. (5) ACCOUNTS array is hardcoded as (cc1 cc2 cc3 hataricc nicxxx) — adding a new account requires a source code edit. Should auto-discover from ~/.claude-accounts/*/ like kimi-account does.","type":"bug","priority":1,"status":"open","created":"2026-03-01T00:00:00Z","updated":"2026-03-01T00:00:00Z","tags":["portability","check-credit","parsing","fragile"]}
{"id":"ais-5","title":"HIGH: Missing CLI features needed for scripting and daily workflows","description":"(1) 'ais ls' and 'ais accounts' have no --json output flag — makes it hard to script against or integrate with orchestrators; every consumer must parse human-formatted table output. (2) No 'ais status <name>' subcommand — callers must run 'ais inspect' and manually parse output to determine if a session is running/idle/hung/dead/rate-limited; a structured status command would return a single state token. (3) No 'ais rotate <name> -A <account>' command — SKILL.md documents the manual steps (kill + recreate with new account) for rate-limit recovery, but there is no CLI shortcut; this forces orchestrators to implement the logic themselves. (4) No 'ais ls --health' flag — currently no way to do a quick liveness ping across all sessions without reading and parsing full inspect output for each one.","type":"feature","priority":1,"status":"open","created":"2026-03-01T00:00:00Z","updated":"2026-03-01T00:00:00Z","tags":["cli","ux","scripting","feature","bin/ais"]}
{"id":"ais-6","title":"MEDIUM: DRY violations — account management and rate-limit detection duplicated","description":"(1) Account listing/discovery logic is independently implemented in three places: bin/ais cmd_accounts(), bin/kimi-account cmd_list(), and scripts/check-kimi-credit.sh discovery loop — each has slightly different error handling, glob patterns, and output format; bugs fixed in one do not propagate. (2) Rate-limit detection using RATE_LIMIT_PATTERN is copy-pasted into cmd_inspect(), cmd_watch(), kimi-account cmd_check(), and check-kimi-credit.sh check_account() — should be a single shared check_rate_limit() helper. (3) The Kimi test command ('Say just the word ok' + timeout 20) appears identically in bin/kimi-account cmd_check() and scripts/check-kimi-credit.sh — should be a shared test_kimi_account() function. (4) CLAUDE_LOAD_TIME=14 and KIMI_LOAD_TIME=8 are hardcoded constants — changing startup timing for a new agent version requires source edits in multiple files; should respect env var overrides: ${CLAUDE_LOAD_TIME:-14}.","type":"task","priority":2,"status":"open","created":"2026-03-01T00:00:00Z","updated":"2026-03-01T00:00:00Z","tags":["refactoring","dry","account-management","rate-limit"]}
{"id":"ais-7","title":"MEDIUM: Code quality and error handling inconsistencies","description":"(1) bin/kimi-account uses raw 'echo \"Error: ...\"' and 'echo \"  Error: ...\"' instead of the die()/warn()/info() helpers defined in bin/ais — inconsistent output format and no exit on error. (2) bin/kimi-account cmd_setup(): silently skips malformed/non-key lines with no user feedback — should log 'warn: skipping invalid line: ...' so users know which lines were rejected. (3) bin/kimi-account cmd_list(): API key extraction uses 'grep api_key | grep -o sk-[^\"]*' which breaks if there are comments or multiple api_key lines in the TOML. (4) bin/kimi-account: OAuth credential file is checked for existence but its JSON content is never validated — an empty or truncated file is treated as a successful login. (5) bin/kimi-account: Kimi model hardcoded as 'kimi-for-coding' in the config template with no env var override (e.g. ${KIMI_MODEL:-kimi-for-coding}). (6) check-kimi-credit.sh: Python JWT base64 padding calculation uses 'payload += \"=\" * (4 - len(payload) % 4)' which adds 4 extra padding chars when len%4==0; correct form is 'while len(payload) % 4: payload += \"=\"'.","type":"task","priority":2,"status":"open","created":"2026-03-01T00:00:00Z","updated":"2026-03-01T00:00:00Z","tags":["code-quality","error-handling","bin/kimi-account","scripts"]}
{"id":"ais-8","title":"MEDIUM: Zero test infrastructure — no automated tests exist","description":"The project has no test directory, no .bats files, and no runtime test scripts. CI only runs shellcheck (syntax checking) — semantically broken scripts pass CI. Minimum test coverage needed: (1) tests/ais-smoke.bats: BATS test covering the core session lifecycle (create → inspect → inject → kill) using a mock or stub tmux session. (2) tests/kimi-account.bats: Account add/list/check functions with fixture config files. (3) Update .github/workflows/ci.yml to run 'bats tests/' after shellcheck. (4) .gitignore is missing patterns for '.kimi/', 'tmp/', and '*.log' files that accumulate during testing.","type":"chore","priority":2,"status":"open","created":"2026-03-01T00:00:00Z","updated":"2026-03-01T00:00:00Z","tags":["testing","ci","bats","gitignore"]}
{"id":"ais-9","title":"MEDIUM: Hardcoded timing constants and terminal compatibility issues","description":"(1) CLAUDE_LOAD_TIME=14 and KIMI_LOAD_TIME=8 (in bin/ais) and equivalent wait values in check-credit.sh/check-kimi-credit.sh are all hardcoded — users running slower machines or future agent versions with different startup times must patch source code. All should respect env var overrides: CLAUDE_LOAD_TIME=${CLAUDE_LOAD_TIME:-14}. Same for KIMI_CHECK_TIMEOUT (hardcoded 20s in kimi-account and check-kimi-credit.sh). (2) Table output in bin/ais, bin/kimi-account, check-credit.sh, and check-kimi-credit.sh uses Unicode box-drawing characters (─, ├, │, ┼) without checking terminal capabilities — these render as garbage in non-UTF-8 locales, Windows terminals, and CI log outputs. Should detect $LANG or $TERM and fall back to ASCII (-, +, |) when needed.","type":"task","priority":2,"status":"open","created":"2026-03-01T00:00:00Z","updated":"2026-03-01T00:00:00Z","tags":["configuration","terminal","portability","timing"]}
{"id":"ais-10","title":"LOW: Documentation gaps across setup guides, quickstart, and troubleshooting","description":"(1) docs/agent-setup.md has no troubleshooting section — common failure modes (auth expiry, missing binaries, wrong permissions, Claude Code version mismatch) are undocumented, leaving users stranded. (2) No docs/quickstart.md — new users must read multiple long docs to run their first session; a single sub-5-minute guide covering install → account → create → watch → kill is missing. (3) docs/tmux-agent-control.md covers send/capture patterns but has no error recovery recipes — e.g. 'session crashed mid-capture', 'agent stopped responding', 'pane split accidentally'. (4) README.md has no architecture diagram showing the tmux-as-execution-layer design; also lacks cost/billing guidance (which accounts to use for which workloads). (5) CONTRIBUTING.md is too brief — no instructions for running tests (once ais-8 is done), no PR review SLA, and no guidance on how to add support for a new agent type.","type":"chore","priority":3,"status":"open","created":"2026-03-01T00:00:00Z","updated":"2026-03-01T00:00:00Z","tags":["documentation","ux","onboarding","contributing"]}
